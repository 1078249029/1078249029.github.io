<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" /><title>STM32 - 吾铭子</title><meta name="Description" content="吾铭子"><meta property="og:url" content="https://1078249029.github.io/posts/stm32/">
  <meta property="og:site_name" content="吾铭子">
  <meta property="og:title" content="STM32">
  <meta property="og:description" content="STM32STM32 常用寄存器缩写: CR 控制寄存器 SR 状态寄存器 DR 数据寄存器 ST公司出品的Microcontroller(微控制器) Cortex-M内核 学习的是M3内核 供电电压 2.0V-3.6V(标准3.3V)，USB输出电压是5V AHB 先进高性能总线 APB 外设总线 内核的外设不需要开启时钟
![](vx_images/262091315231061_1.png =600x) 复用输入指的是同一引脚默认有很多输入功能，需要对GPIO指定使用哪个功能(TIM4就无复用功能)，而重定义则是非默认功能，需要进行AFIO选择进而变为复用功能 ![2024-01-04_15-49](vx_images/384774915259273_1.png =600x) ![2023-10-16_22-3845](vx_images/581333822257516_1.png =600x) ![2023-10-13_16-2857](vx_images/198312916249480_1.png =600x) ![2023-10-13_17-0326](vx_images/285460417237347_1.png =600x) 最小系统电路: 单独的芯片不能工作，需要连接最基本的电路，由这些电路组成的就是最小系统电路
GPIORCC : 复位和时钟控制 GPIO(General Purpose Input Output)通用输入输出口 GPIO高低电平看外部输入输出,输入情况下,与外部电平极性相同.如果外部信号非常小,则为避免引入干扰源选择浮空输入,不清楚外部信号的情况下也选择浮空输入,输出情况下看外部负载电压要求 AIN是模拟输入专用模式，此时GPIO不输入输出，防止对外界信号干扰 AF_PP是复用推挽模式，片上外设使用这种模式 ![2023-10-14_16-5334](vx_images/231855213249483_1.png =600x) ![2023-10-14_16-5138](vx_images/216535216249481_1.png =600x) ![2023-10-15_09-3232](vx_images/447993209231056_1.png =600x) VDD 3.3V VSS 0V GPIO 控制流程：1.激活 RCC 时钟 2.使用 GPIO_Init 初始化 GPIO 函数
施密特触发器的作用是对外界信号进行滤波，规定上下限，使得当超过上限输出为1，低于下限输出为0，上下限之间输出不变，这样可以维持信号的稳定性 在输出模式下，输入也是有效的 OLED函数showhexnum与shownum每逢10相差6，hexnum的数值比num高6
中断NVIC (Nested Vectored Interrupt Controller) 嵌套中断向量控制器: 统一分配中断优先级和管理中断 响应优先级: 完成当前任务后进行响应优先级的任务 中断优先级: 立即结束当前任务并进行中断优先级任务(可以决定中断嵌套,抢占优先级高的可以进行中断嵌套) 两个优先级相同的情况下按中断号排队,所以并不是先来后到 NVIC 分组在整个项目中只需要执行一次 ![2023-10-17_08-4844](vx_images/543234908231058_1.png =600x) EXTI (external interrupt) 外部中断控制器 EXTI 负责监控GPIO的电平变化,当产生跳变时,EXTI向NVIC发送中断申请,经NVIC裁决优先级后执行中断程序 ![2023-10-16_13-5138](vx_images/571455113231057_1.png =600x) ![2023-10-16_15-0452](vx_images/49500515237350_1.png =600x) GPIO_EXTILineConfig(GPIO_PortSourceGPIOx,GPIO_PinSourcex) 是配置AFIO的函数，参数是GPIO的通道和引脚">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-10-18T13:57:04+08:00">
    <meta property="article:modified_time" content="2024-10-28T19:56:24+08:00">
    <meta property="article:tag" content="Tech">
    <meta property="article:tag" content="STM32">
    <meta property="og:image" content="https://1078249029.github.io/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://1078249029.github.io/logo.png">
  <meta name="twitter:title" content="STM32">
  <meta name="twitter:description" content="STM32STM32 常用寄存器缩写: CR 控制寄存器 SR 状态寄存器 DR 数据寄存器 ST公司出品的Microcontroller(微控制器) Cortex-M内核 学习的是M3内核 供电电压 2.0V-3.6V(标准3.3V)，USB输出电压是5V AHB 先进高性能总线 APB 外设总线 内核的外设不需要开启时钟
![](vx_images/262091315231061_1.png =600x) 复用输入指的是同一引脚默认有很多输入功能，需要对GPIO指定使用哪个功能(TIM4就无复用功能)，而重定义则是非默认功能，需要进行AFIO选择进而变为复用功能 ![2024-01-04_15-49](vx_images/384774915259273_1.png =600x) ![2023-10-16_22-3845](vx_images/581333822257516_1.png =600x) ![2023-10-13_16-2857](vx_images/198312916249480_1.png =600x) ![2023-10-13_17-0326](vx_images/285460417237347_1.png =600x) 最小系统电路: 单独的芯片不能工作，需要连接最基本的电路，由这些电路组成的就是最小系统电路
GPIORCC : 复位和时钟控制 GPIO(General Purpose Input Output)通用输入输出口 GPIO高低电平看外部输入输出,输入情况下,与外部电平极性相同.如果外部信号非常小,则为避免引入干扰源选择浮空输入,不清楚外部信号的情况下也选择浮空输入,输出情况下看外部负载电压要求 AIN是模拟输入专用模式，此时GPIO不输入输出，防止对外界信号干扰 AF_PP是复用推挽模式，片上外设使用这种模式 ![2023-10-14_16-5334](vx_images/231855213249483_1.png =600x) ![2023-10-14_16-5138](vx_images/216535216249481_1.png =600x) ![2023-10-15_09-3232](vx_images/447993209231056_1.png =600x) VDD 3.3V VSS 0V GPIO 控制流程：1.激活 RCC 时钟 2.使用 GPIO_Init 初始化 GPIO 函数
施密特触发器的作用是对外界信号进行滤波，规定上下限，使得当超过上限输出为1，低于下限输出为0，上下限之间输出不变，这样可以维持信号的稳定性 在输出模式下，输入也是有效的 OLED函数showhexnum与shownum每逢10相差6，hexnum的数值比num高6
中断NVIC (Nested Vectored Interrupt Controller) 嵌套中断向量控制器: 统一分配中断优先级和管理中断 响应优先级: 完成当前任务后进行响应优先级的任务 中断优先级: 立即结束当前任务并进行中断优先级任务(可以决定中断嵌套,抢占优先级高的可以进行中断嵌套) 两个优先级相同的情况下按中断号排队,所以并不是先来后到 NVIC 分组在整个项目中只需要执行一次 ![2023-10-17_08-4844](vx_images/543234908231058_1.png =600x) EXTI (external interrupt) 外部中断控制器 EXTI 负责监控GPIO的电平变化,当产生跳变时,EXTI向NVIC发送中断申请,经NVIC裁决优先级后执行中断程序 ![2023-10-16_13-5138](vx_images/571455113231057_1.png =600x) ![2023-10-16_15-0452](vx_images/49500515237350_1.png =600x) GPIO_EXTILineConfig(GPIO_PortSourceGPIOx,GPIO_PinSourcex) 是配置AFIO的函数，参数是GPIO的通道和引脚">
<meta name="application-name" content="吾铭子">
<meta name="apple-mobile-web-app-title" content="吾铭子">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<link rel="canonical" href="https://1078249029.github.io/posts/stm32/" /><link rel="prev" href="https://1078249029.github.io/posts/vim/" /><link rel="next" href="https://1078249029.github.io/posts/c-review/" />
<link rel="stylesheet" href="/css/main.min.css"><link rel="stylesheet" href="/css/style.min.css"><script type="application/ld+json">{"@context": "https://schema.org","@type": "BlogPosting",
        "headline": "STM32",
        "inLanguage": "zh-cn",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://1078249029.github.io/posts/stm32/"
        },"genre": "posts","keywords":["Tech","STM32"],"wordcount":  450 ,
        "url": "https://1078249029.github.io/posts/stm32/","datePublished": "2023-10-18T13:57:04+08:00","dateModified": "2024-10-28T19:56:24+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "吾铭子",
                "url": "wumingzi.top"
            },"description": ""
    }</script></head>


<body data-instant-intensity="viewport" class="tw-flex tw-min-h-screen tw-flex-col"><script type="text/javascript">
    function setTheme(theme) {
      document.body.setAttribute('theme', theme); 
      document.documentElement.className = theme;
      document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');
      if (theme === 'light') {
        document.documentElement.classList.remove('tw-dark')
      } else {
        document.documentElement.classList.add('tw-dark')
      }
      window.theme = theme;   
      window.isDark = window.theme !== 'light' 
    }
    function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
    function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
    if (window.localStorage && localStorage.getItem('theme')) {
        let theme = localStorage.getItem('theme');
        if (theme === 'light' || theme === 'dark') {
        setTheme(theme);
        } else {
            if ((window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        }
      } else { 
        if ('auto' === 'light' || 'auto' === 'dark') 
            setTheme('auto'), saveTheme('auto'); 
        else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');
    }
    let metaColors = {'light': '#f8f8f8','dark': '#161b22'}
    getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    window.switchThemeEventSet = new Set()
</script><div id="back-to-top"></div>
    <div id="mask"></div><header class="desktop print:!tw-hidden" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="吾铭子">吾铭子</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item"
                    href="/posts/" > 归档 </a><a class="menu-item"
                    href="/tags/" > 标签 </a><a class="menu-item"
                    href="/categories/" > 分类 </a><a class="menu-item"
                    href="/about/" > 关于 </a><a class="menu-item"
                    href="/friend/" > 友链 </a><a class="menu-item"
                    href="/essay/" > 杂记 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                    <input type="text"
                        placeholder="搜索文章标题或内容..."
                        id="search-input-desktop">
                    <button class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
                    </button>
                    <button class="search-button search-clear" id="search-clear-desktop" title="清空">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>
                    </button>
                    <span class="search-button search-loading tw-animate-spin" id="search-loading-desktop">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"/></svg>
                    </span>
                </span><button class="menu-item theme-switch" aria-label="切换主题">
                    <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
                </button></div>
        </div>
    </div>
</header><header class="mobile print:!tw-hidden" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="吾铭子">吾铭子</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                <div class="search mobile" id="search-mobile">
                    <input type="text"
                        placeholder="搜索文章标题或内容..."
                        id="search-input-mobile">
                    <button class="search-button search-toggle tw-h-10" id="search-toggle-mobile" title="搜索">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
                    </button>
                    <button class="search-button search-clear tw-h-fit" id="search-clear-mobile" title="清空">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>
                    </button>
                    <span class="search-button search-loading tw-animate-spin" id="search-loading-mobile">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"/></svg>
                    </span>
                </div>
                <button class="search-cancel" id="search-cancel-mobile">
                    取消
                </button>
            </div><a class="menu-item" href="/posts/" title="" >归档</a><a class="menu-item" href="/tags/" title="" >标签</a><a class="menu-item" href="/categories/" title="" >分类</a><a class="menu-item" href="/about/" title="" >关于</a><a class="menu-item" href="/friend/" title="" >友链</a><a class="menu-item" href="/essay/" title="" >杂记</a><button class="menu-item theme-switch tw-w-full" aria-label="切换主题">
                <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
            </button></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="tw-mx-4 tw-flex-1"><div class="toc print:!tw-hidden" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#stm32">STM32</a>
      <ul>
        <li><a href="#gpio">GPIO</a></li>
        <li><a href="#中断">中断</a></li>
        <li><a href="#定时器">定时器</a></li>
        <li><a href="#adc">ADC</a></li>
        <li><a href="#dma">DMA</a></li>
        <li><a href="#uart">UART</a></li>
        <li><a href="#i2c">I2C</a></li>
        <li><a href="#spi">SPI</a></li>
        <li><a href="#bkp与rtc">BKP与RTC</a></li>
        <li><a href="#pwr">PWR</a></li>
        <li><a href="#看门狗">看门狗</a></li>
        <li><a href="#启动文件详解">启动文件详解</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><dialog id="toc-dialog" class="tw-max-w-full tw-w-full tw-max-h-full tw-h-full tw-ml-16">
        <div class="toc tw-mx-4 tw-max-w-full">
            <h2 class="tw-mx-0 tw-my-6 tw-uppercase tw-text-2xl">目录</h2>
            <div class="toc-content"><nav id="TableOfContents">
  <ul>
    <li><a href="#stm32">STM32</a>
      <ul>
        <li><a href="#gpio">GPIO</a></li>
        <li><a href="#中断">中断</a></li>
        <li><a href="#定时器">定时器</a></li>
        <li><a href="#adc">ADC</a></li>
        <li><a href="#dma">DMA</a></li>
        <li><a href="#uart">UART</a></li>
        <li><a href="#i2c">I2C</a></li>
        <li><a href="#spi">SPI</a></li>
        <li><a href="#bkp与rtc">BKP与RTC</a></li>
        <li><a href="#pwr">PWR</a></li>
        <li><a href="#看门狗">看门狗</a></li>
        <li><a href="#启动文件详解">启动文件详解</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
        </div>
    </dialog><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single print:!tw-w-full print:!tw-max-w-none print:!tw-m-0 print:!tw-p-0"><h1 class="single-title" data-pagefind-meta="date:2023-10-18" data-pagefind-body>STM32</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><a href="wumingzi.top" title="Author" rel=" author" class="author">吾铭子</a>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category"><a href="/categories/tech/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>Tech</a></span></div>
            <div class="post-meta-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;<time datetime="2023-10-18">2023-10-18</time>&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg>&nbsp;<time datetime="2024-10-28">2024-10-28</time>&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;约 450 字&nbsp;
                    <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;预计阅读 2 分钟&nbsp;</div>
        </div><div class="details toc print:!tw-block" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#stm32">STM32</a>
      <ul>
        <li><a href="#gpio">GPIO</a></li>
        <li><a href="#中断">中断</a></li>
        <li><a href="#定时器">定时器</a></li>
        <li><a href="#adc">ADC</a></li>
        <li><a href="#dma">DMA</a></li>
        <li><a href="#uart">UART</a></li>
        <li><a href="#i2c">I2C</a></li>
        <li><a href="#spi">SPI</a></li>
        <li><a href="#bkp与rtc">BKP与RTC</a></li>
        <li><a href="#pwr">PWR</a></li>
        <li><a href="#看门狗">看门狗</a></li>
        <li><a href="#启动文件详解">启动文件详解</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content" data-pagefind-body><h1 id="stm32" class="headerLink">
    <a href="#stm32" class="header-mark"></a>STM32</h1><p>STM32 常用寄存器缩写: CR 控制寄存器 SR 状态寄存器 DR 数据寄存器
ST公司出品的Microcontroller(微控制器) Cortex-M内核 学习的是M3内核
供电电压 2.0V-3.6V(标准3.3V)，USB输出电压是5V
AHB 先进高性能总线
APB 外设总线
内核的外设不需要开启时钟</p>
<!-- more -->
<p>![](vx_images/262091315231061_1.png =600x)
复用输入指的是同一引脚默认有很多输入功能，需要对GPIO指定使用哪个功能(TIM4就无复用功能)，而重定义则是非默认功能，需要进行AFIO选择进而变为复用功能
![2024-01-04_15-49](vx_images/384774915259273_1.png =600x)
![2023-10-16_22-3845](vx_images/581333822257516_1.png =600x)
![2023-10-13_16-2857](vx_images/198312916249480_1.png =600x)
![2023-10-13_17-0326](vx_images/285460417237347_1.png =600x)
最小系统电路: 单独的芯片不能工作，需要连接最基本的电路，由这些电路组成的就是最小系统电路</p>
<h2 id="gpio" class="headerLink">
    <a href="#gpio" class="header-mark"></a>GPIO</h2><p>RCC : 复位和时钟控制
GPIO(General Purpose Input Output)通用输入输出口
GPIO高低电平看外部输入输出,输入情况下,与外部电平极性相同.如果外部信号非常小,则为避免引入干扰源选择浮空输入,不清楚外部信号的情况下也选择浮空输入,输出情况下看外部负载电压要求
AIN是模拟输入专用模式，此时GPIO不输入输出，防止对外界信号干扰
AF_PP是复用推挽模式，片上外设使用这种模式
![2023-10-14_16-5334](vx_images/231855213249483_1.png =600x)
![2023-10-14_16-5138](vx_images/216535216249481_1.png =600x)
![2023-10-15_09-3232](vx_images/447993209231056_1.png =600x)
VDD 3.3V     VSS 0V
GPIO 控制流程：1.激活 RCC 时钟    2.使用 GPIO_Init 初始化 GPIO 函数<br>
施密特触发器的作用是对外界信号进行滤波，规定上下限，使得当超过上限输出为1，低于下限输出为0，上下限之间输出不变，这样可以维持信号的稳定性
在输出模式下，输入也是有效的
OLED函数showhexnum与shownum每逢10相差6，hexnum的数值比num高6</p>
<h2 id="中断" class="headerLink">
    <a href="#%e4%b8%ad%e6%96%ad" class="header-mark"></a>中断</h2><p>NVIC (Nested Vectored Interrupt Controller) 嵌套中断向量控制器: 统一分配中断优先级和管理中断
响应优先级: 完成当前任务后进行响应优先级的任务    中断优先级: 立即结束当前任务并进行中断优先级任务(可以决定中断嵌套,抢占优先级高的可以进行中断嵌套)
两个优先级相同的情况下按中断号排队,所以并不是先来后到
NVIC 分组在整个项目中只需要执行一次
![2023-10-17_08-4844](vx_images/543234908231058_1.png =600x)
EXTI (external interrupt) 外部中断控制器
EXTI 负责监控GPIO的电平变化,当产生跳变时,EXTI向NVIC发送中断申请,经NVIC裁决优先级后执行中断程序
![2023-10-16_13-5138](vx_images/571455113231057_1.png =600x)
![2023-10-16_15-0452](vx_images/49500515237350_1.png =600x)
GPIO_EXTILineConfig(GPIO_PortSourceGPIOx,GPIO_PinSourcex) 是配置AFIO的函数，参数是GPIO的通道和引脚</p>
<h2 id="定时器" class="headerLink">
    <a href="#%e5%ae%9a%e6%97%b6%e5%99%a8" class="header-mark"></a>定时器</h2><p>TIM (timer) 定时器
TRGO(Trigger Out)定时器主模式，可以不用进中断就可以执行程序
![2023-10-18_13-4440](vx_images/63075813242496_1.png =600x)
预分频器(PSC)对时钟频率进行分频,置0 不分频,置1 频率=原时钟频率/2  置2 频率=原时钟频率/3 等等
下列公式注意预分频器需要加 1,ARR加1的原因是ARR从 0 开始计数 CK_PSC是 72MHz
![2023-10-18_14-4239](vx_images/209484414237352_1.png =600x)
![2023-10-18_14-4245](vx_images/359324514257518_1.png =600x)
![2024-01-23_12-12](vx_images/195431212258590_1.png =600x)
![2023-10-18_13-4450](vx_images/215645813260376_1.png =600x)
OC(output compare) : 输出比较
PWM(pause width modulation) : 脉冲宽度调制
![2023-10-18_20-4321](vx_images/378974320231059_1.png =600x)
![2023-10-18_20-5305](vx_images/290555320249485_1.png =600x)
IC(Input Capture): 输入捕获
输入捕获每次CNT转运到CCR时需要清0,此时可以配置从模式,让硬件电路自动清零
![2023-10-20_16-3336](vx_images/45323416249487_1.png =600x)
FP(filter polarity)，滤波器极性选择
主模式:让定时器内部信号映射到TRGO引脚,用于触发别的外设    从模式:接受其他外设或自身的信号用于控制自身定时器的运行
![2023-10-23_16-0729](vx_images/57140816231064_1.png =600x)
![2023-10-20_16-3416](vx_images/275013416237354_1.png =600x)
滤波器也是计数器,但不会改变信号原有的频率,原理是当有x个信号均为同一性质(高电平或低电平时)才滞后输出信号,x是给定的参数值
通道3,4不支持PWMI配置
使用编码器时,定时器的其他功能就无法使用了
通道3,4不支持编码器
![2023-10-20_18-0044](vx_images/586090018257520_1.png =600x)
![2023-10-23_19-5640](vx_images/126585719249490_1.png =600x)
![2023-12-22_10-22](vx_images/440272210231263_1.png =600x)
TI1可以选择接到TI1FP1上也可以选择TI1FP2上，这样可以通过极性选择来计算出上升沿到下降沿的时间，这个功能可以在PWMI模式中体现
![2023-10-20_22-4215](vx_images/373924222231061_1.png =600x)
编码器会接管时钟,所以不需要TIM_InternalClockConfig()
uint16_t 中比0小一位是65535，如果想变为-1需要把uint强制转换为int</p>
<h2 id="adc" class="headerLink">
    <a href="#adc" class="header-mark"></a>ADC</h2><p>ADC(Analog-Digital Converter)
STM32 ADC是12位的 最大值4096 可以测量0-3.3V
PWM是DAC的一种，具有功率损耗小的优点，常用来给大型直流电机调速，32没有DAC外设
ADC数据来源于比较器的结果，其核心是未知的外界信号与芯片给定的信号进行比较，并用逐次逼近寄存器(SAR)采用二分法分分割芯片信号，直至与外界信号相等，此时SAR的值即为外界信号值
规则组支持16通道，注入组支持4通道，但规则组只有一个数据寄存器，注入组有四个。使用规则组时可以申请DMA来帮助通道转换效率
EOC(End Of Convert) 规则组: EOC 注入组: JEOC
注意要开启RCC_ADC的时钟
![2023-10-21_12-5239](vx_images/130635312231062_1.png =600x)
通道数大于 1 扫描模式才有意义，转换是对循环而言
在连续转换模式下，会自动读取EOC的值，所以不需要手动写 while 判断是否转换完毕
![2023-10-21_12-5301](vx_images/206605312249488_1.png =600x)
![2023-12-23_11-46](vx_images/273734611234218_1.png =600x)
![2023-12-23_11-46_1](vx_images/342044611243165_1.png =600x)
![2023-12-23_11-46_2](vx_images/408774611236050_1.png =600x)
单次连续模式是针对某个通道，扫描非扫描模式针对所有通道
保持时间越长，越能抵抗毛刺信号的干扰
![2023-10-21_13-0507](vx_images/238990513237355_1.png =600x)
![2023-10-21_13-0729](vx_images/415310713257521_1.png =600x)
ADC数据对齐方式一般选右对齐，左对齐是为了直接取出数据的高n位，方便裁剪分辨率，但是也可以通过右对齐然后读取出的数据进行右移的方式来操作分辨率</p>
<h2 id="dma" class="headerLink">
    <a href="#dma" class="header-mark"></a>DMA</h2><p>DMA(Direct Memory Access)直接存储器访问
STM32有7个DMA1通道,每个通道支持软件触发和特定的硬件触发
如果是<strong>Flash到SRAM</strong>的数据搬运,应使用<strong>软件触发</strong>,此时数据运输速率最快,如果是外设到SRAM,应使用硬件触发,此时不需要以最快的速度转运数据,而是需要特定时机才触发转运
DMA只操作存储器到存储器的数据搬运,上面提的外设到SRAM是指外设的存储器到SRAM
内核外设: NVIC SysTick
DCode总线专门访问Flash <br>
DMA虽然有多个通道,但是只有一条DMA总线,需要仲裁器进行仲裁,使优先级高的通过获得数据,通道号越小优先级越高
![2023-10-22_11-5155](vx_images/193325211231063_1.png =600x)
数据宽度参数  字节: 8位 半字: 16位 字: 32位
自动重装器决定传输计数器自减到0后是否恢复到初值,如果恢复到初值则为连续模式,否则为单次模式
软件触发不能与自动重装器同时使用,那样DMA就停不下来了
M2M位置1是软件触发,M2M置0是硬件触发
<strong>传输计数器等于0后需要将DMA_Cmd DISABLE,然后改变传输计数器的值,再DMA_Cmd ENABLE,DMA才能重新工作,简而言之,写传输计数器需要关闭DMA</strong>
小位数数据转移到大位数数据会在高位补0,大位数数据转移到小位数数据会舍弃高位
DMA和CPU对同一地址进行访问时,仲裁器会优先选择CPU进行访问,但是也会为DMA保留一半的总线带宽
Flash存储编译后的C代码和常量数据
const定义的常量存储在Flash里 普通变量存储在SRAM里
ADC -&gt; DR 得到的是DR的值 &amp;ADC -&gt; DR得到的是DR的地址</p>
<h2 id="uart" class="headerLink">
    <a href="#uart" class="header-mark"></a>UART</h2><p>USART支持同步异步传输，有时钟线，并对协议进行增强
UART仅支持异步传输，没有时钟线</p>
<p>![2023-11-08_14-4250](vx_images/217544314231149_1.png =600x)
全双工: 通信双方能够同时双向通信    一般两根通信线，一根发射一根接收
半双工: 通信双方同时只能有一方通信
单工：无论何时都只有一方能进行通信，另一方始终接收
全双工: 打电话    半双工: 对讲机    对讲机: 广播
差分信号抗干扰能力强，传输速度和距离会很高
硬件流控制: 当信息发送方和接收方
I2C 和 SPI 有时钟线，所以是同步时钟
USART默认为低位先行
![2023-12-23_11-25](vx_images/393512511231714_1.png =600x)
![2023-11-08_15-0206](vx_images/164010215249575_1.png =600x)
RS232 1 0 位如此设置的原因是增加抗干扰能力
RS485 是差分信号，传输距离可达上千米
![2023-11-08_15-1736](vx_images/575961815237442_1.png =600x)
二进制调制情况下波特率 == 比特率
奇偶校验: 校验位补 0 或 1 使得数据位+校验位有偶数或奇数个 1
![](vx_images/580015516231149_1.png =600x)
数据流控的: 通过告知其他带有数据流控的设备，本机是否可以接受或发送数据，从而解决通信双方处理数据能力不同而导致一方在忙，另一方发送的数据丢失或覆盖之前发送数据的问题
![2023-11-08_17-0036](vx_images/540040017249575_1.png =600x)
TXE(发送数据寄存器非空)与RXNE(接受移位寄存器非空) 是TDR与RDR置位的
单片机的TX和RX与USB转串口模块的TX和RX要交叉连接
![2023-11-08_17-1603](vx_images/211121617237442_1.png =600x)
![2023-11-08_17-1643](vx_images/514231617257608_1.png =600x)
波特率除以16是因为采样时钟(fpclk)是以波特率的16倍速度进行采样的，具体数值硬件会帮忙算，我们只需要直接给出波特率就行
Odd 奇数 Even 偶数
![2023-11-09_21-4348](vx_images/27624421231150_1.png =600x)
固定包长适合载荷数据与包头包尾重复率高的情况，这样利于分割以及接收数据
![2023-12-23_11-21](vx_images/278622111241184_1.png =600x)
在发送数据时需要加上包头包尾(个人规定0xFF为包头，0xFE为包尾)
相比文本数据包，HEX数据包效率高，因为文本还需要编码译码的过程
![2023-11-09_22-0509](vx_images/215810522249576_1.png =600x)
HEX数据包接收运用了状态机的思想，通过不同的S的值进中断后的行为不同，进而执行相应的动</p>
<h2 id="i2c" class="headerLink">
    <a href="#i2c" class="header-mark"></a>I2C</h2><p>I2C(inter IC Bus)
同步协议需要时钟线来控制数据的读写，好处是对时钟要求不严格，不需要硬件电路的配合，而异步需要硬件电路产生准确的时钟信号才能通信。因此同步协议主打低端市场。同时，如果主机进入中断，异步协议就会出错，而同步协议利用时钟线则不会出错
第一个数据帧最低位0为写，1为读
![2023-11-10_14-5525](vx_images/366935514231151_1.png =600x)
![2023-11-10_15-1740](vx_images/506021715249577_1.png =600x)
I2C两根总线为避免主从设备同时输出造成电源短路现象，规定了SDA与SCL均采用开漏输出模式，这样，无论主从设备是否同时输出，均不会达到强上拉，而是在外接电阻R的作用下被限制为弱上拉，下拉模式不受影响。同时，在下拉状态中，多主机情况下可以进行I2C控制权的仲裁
![2023-11-10_15-1740](vx_images/9423215237444_1.png =600x)
![2023-11-20_12-1845](vx_images/42071912231161_1.png =600x)
![2023-12-23_12-09](vx_images/487730912263614_1.png =600x)
![2023-11-10_15-5315](vx_images/241635315246834_1.png =600x)
0表示应答 1表示非应答
SCL低电平变换SDA数据，高电平读取SDA数据
由于I2C对硬件要求不高，因此软件可以完全模拟I2C协议
![2023-11-11_17-0558](vx_images/106080617231152_1.png =600x)
![2023-11-11_17-0623](vx_images/292720617249578_1.png =600x)
硬件I2C与USART类似，都是通过TXE和RXNE寄存器控制数据收发，只不过I2C是高位先行，因此移位寄存器向左移位，而USART低位先行，是向右移位，这里的高低位先行指的是HEX数据的发送接收模式，正常的文本模式下仍按照人类的从左至右(从高到低)发送文本
7位寻址与10位寻址的区别是，10位寻址时前两个数据包是寻址，之后的是数据，而7位则是第一个数据包是寻址
EV(event): 事件，产生多个标志位
![2023-11-13_15-5406](vx_images/349465415231154_1.png =600x)
![2023-11-13_15-5518](vx_images/326215515249580_1.png =600x)
I2C在频率很高时，由于开漏模式弱上拉的作用，实际的SCL和SDA并不完美，当频率快到一定程度时，SCL的方波甚至会被压缩至三角波，为了给SDA传送数据时所需要的上拉一定时间，所以需要SCL低电平时占空比适当增加
由于I2C的弱上拉的作用，使得在标准模式下支持100KHz的信号，快速模式下也只能支持400KHz的信号
硬件I2C下，STM32默认为从模式
STM32的I2C被分为主从两种模式，每种模式又被分为发送和接受两种模式
![2023-11-21_13-1436](vx_images/12961513231162_1.png =600x)
![2023-11-21_13-1509](vx_images/156651513249588_1.png =600x)
硬件I2C接收模式下，要在发送最后一个字节前将STOP置1，并把Ack置0，这是因为停止位(EV7_1)配置位于接收数据之前，只有接受下个数据后，才能把之前设置的停止事件发送出去。而发送模式的停止事件(EV8_2)位于发送数据后</p>
<h2 id="spi" class="headerLink">
    <a href="#spi" class="header-mark"></a>SPI</h2><p>SPI(serial peripheral interface)，应用领域与I2C类似，都用来负责主控与外挂芯片之间的通信，支持一主多从但不支持多主机。通信模式为同步，全双工。与I2C区别在于，I2C是用最少的硬件资源实现最多的功能.
SPI有四根通信线，分别为SCK(serial clock)，MOSI(master output slave input)，MISO(master input slave output)，SS(slave select)
SPI与I2C一样，均采用高位先行的传输模式
SPI没有应答机制，有几个从机就有几个SS线
为防止多个从机的MISO互相冲突，SPI规定当从机的SS没有被选中(置0)时，从机的MISO默认为高阻态，SS被选中时，MISO才被改为推挽输出。主机输入为上拉输出(MISO)，主机输出为推挽(包括片选，时钟，MOSI)
输出引脚为推挽输出，输入引脚为浮空或上拉
SPI的理解可以不采用江科大的上升下降沿分别移入移出的思想，可以采用纯采样的思想<a href="https://blog.csdn.net/p0o9i83463rrfd4/article/details/123900524" target="_blank" rel="noopener noreferrer">CSDN</a>
![2023-12-23_16-38](vx_images/67613916231376_1.png =600x)
![2023-12-23_16-41](vx_images/164584216231515_1.png =600x)
<a href="https://zhuanlan.zhihu.com/p/290620901" target="_blank" rel="noopener noreferrer">知乎</a>
![2023-11-14_16-1847](vx_images/468571916231155_1.png =600x)
![2023-11-14_17-0955](vx_images/2221017249581_1.png =600x)
![2023-11-14_17-1008](vx_images/157911017237448_1.png =600x)
存储器划分 Block - Sector，并且，整个存储空间全被划分成了Page
发送的3个字节组成的地址，最低位是页里的字节地址，高2个字节是页地址
由于结构特性，Flash的数据bit位只能由1变为0，不能由0变为1，因此写入数据前必须先擦除，将所有数据由0“擦除”至1，而后写入数据.
![2023-11-14_19-4334](vx_images/502194319257614_1.png =600x)
为了防止误操作，Flash使用前需要先写使能
驱动层是沟通应用层与通信层的桥梁
事前等待就是把WaitBusy放在读写函数之前的位置，这样可以提高效率，但安全性会降低(因为程序在读写操作后可能会运行其他代码，这样可以节省时间，但安全性会降低，比如读写操作后再次进行类似读写的操作)，事后代码效率较低但安全性高。并且需要注意的是事前等待需要放在读写函数之前，但事后等待仅放在写函数后即可
写入不能跨页，读取能跨页，写入超过页的限制之后会从页头开始覆盖
SPI要想接收数据必须发送数据，因此可以发一些没用的数据(Dummy Data)给从机</p>
<h2 id="bkp与rtc" class="headerLink">
    <a href="#bkp%e4%b8%8ertc" class="header-mark"></a>BKP与RTC</h2><p>![2023-12-01_21-0209](vx_images/262320221231242_1.png =600x)
UNIX时间戳默认从1970年1月1日开始，而有些C库默认为1900年开始
![2023-12-01_21-0358](vx_images/49470421249668_1.png =600x)
![2023-12-01_21-0419](vx_images/277330421237535_1.png =600x)
![2023-12-01_21-0438](vx_images/467510421257701_1.png =600x)
![2023-12-23_17-26](vx_images/467672617243605_1.png =600x)
HSE(高速外部时钟)
RTC时钟优先选择LSE，因为频率为2^15^因而容易分频
![2023-12-01_21-2350](vx_images/68282421250370_1.png =600x)
![2023-12-01_21-2355](vx_images/250002421246925_1.png =600x)</p>
<h2 id="pwr" class="headerLink">
    <a href="#pwr" class="header-mark"></a>PWR</h2><p>只有外部中断才能唤醒STM32的停止模式，因此PVD，RTC，USB，ETH等可以通向EXTI中断
![2023-12-02_13-5934](vx_images/451815913249669_1.png =600x)
![2023-12-02_13-5301](vx_images/132775313231243_1.png =600x)
![2023-12-03_12-4826](vx_images/447284812231244_1.png =600x)
![2023-12-03_12-4853](vx_images/25854912249670_1.png =600x)
![2023-12-03_12-4910](vx_images/191684912237537_1.png =600x)
从上到下越来越省电，但也越来越难被唤醒
系统进入停机模式时，HSI被选为系统时钟，此时系统主频8MHz，而正常情况下使用的是HSE*9=72MHz，因此会发生Running刷新不及时的现象，此时需要SystemInit来重新初始化时钟
待机模式唤醒后，程序从头开始执行，因此，不需要调用SystemInit</p>
<h2 id="看门狗" class="headerLink">
    <a href="#%e7%9c%8b%e9%97%a8%e7%8b%97" class="header-mark"></a>看门狗</h2><p>看门狗负责复位程序
独立看门狗精度低，使用LSI时钟(40KHz)，窗口看门狗精度高，使用PCLK1的时钟(APB1的时钟，36MHz)
![2023-12-03_12-1627](vx_images/481471612231244_1.png =600x)
键寄存器可以以理解为多位的控制寄存器，这样设计是为了防止外界干扰导致一位的控制寄存器失效，因此设置多位
![2023-12-03_12-1833](vx_images/430081812249670_1.png =600x)
![2023-12-03_12-1854](vx_images/63541912237537_1.png =600x)
![2023-12-03_12-1925](vx_images/316311912257703_1.png =600x)
![2023-12-03_12-1945](vx_images/514261912250372_1.png =600x)
早期唤醒中断可以进行保存数据，再次喂狗等紧急操作，以防止程序未被喂狗而复位
![2023-12-03_12-2117](vx_images/352252112242681_1.png =600x)
窗口时间即为进入WWDG最小的时间，并非通常意义的&quot;窗口&quot;时间
![2023-12-03_12-2142](vx_images/486482112260561_1.png =600x)
利用内部闪存编程时，当读取内部闪存时CPU会被暂停，因为程序放在闪存里，CPU运行的程序需要从闪存中取出，如果此时正在执行中断函数时中断会卡住一段时间。</p>
<h2 id="启动文件详解" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8%e6%96%87%e4%bb%b6%e8%af%a6%e8%a7%a3" class="header-mark"></a>启动文件详解</h2><p><a href="https://doc.embedfire.com/mcu/stm32/f407batianhu/std/zh/latest/book/Startup_file.html" target="_blank" rel="noopener noreferrer">野火Startup_file.html</a></p>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2024-10-28</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line print:!tw-hidden">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/posts/stm32/index.md target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                    </span></div>
            <div class="post-info-share"></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg>&nbsp;<a href="/tags/tech/">Tech</a>,&nbsp;<a href="/tags/stm32/">STM32</a></section>
        <section class="print:!tw-hidden">
            <span><button class="tw-text-fgColor-link-muted hover:tw-text-fgColor-link-muted-hover" onclick="window.history.back();">返回</button></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav print:tw-hidden"><a href="/posts/vim/" class="prev" rel="prev" title="Vim复健计划"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"/></svg>Vim复健计划</a>
            <a href="/posts/c-review/" class="next" rel="next" title="C复健计划">C复健计划<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></a></div>
</div>
</article></main><footer class="footer">
        <div class="footer-container">
            <div class="footer-line">
                <span id="run-time"></span>
            </div><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.145.0">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.1"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg> DoIt</a>
                </div><div class="footer-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 448c-110.532 0-200-89.451-200-200 0-110.531 89.451-200 200-200 110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200zm107.351-101.064c-9.614 9.712-45.53 41.396-104.065 41.396-82.43 0-140.484-61.425-140.484-141.567 0-79.152 60.275-139.401 139.762-139.401 55.531 0 88.738 26.62 97.593 34.779a11.965 11.965 0 0 1 1.936 15.322l-18.155 28.113c-3.841 5.95-11.966 7.282-17.499 2.921-8.595-6.776-31.814-22.538-61.708-22.538-48.303 0-77.916 35.33-77.916 80.082 0 41.589 26.888 83.692 78.277 83.692 32.657 0 56.843-19.039 65.726-27.225 5.27-4.857 13.596-4.039 17.82 1.738l19.865 27.17a11.947 11.947 0 0 1-1.152 15.518z"/></svg>2023 - 2025<span class="author">&nbsp;<a href="wumingzi.top" target="_blank" rel="noopener noreferrer">吾铭子</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer><div class="print:!tw-hidden tw-flex tw-flex-col tw-fixed tw-right-4 tw-bottom-4 tw-gap-2"><a href="#back-to-top" id="back-to-top-button" class="tw-transition-opacity tw-opacity-0 tw-block tw-bg-bgColor-secondary tw-rounded-full" style="padding: 0.6rem; line-height: 1.3rem; font-size: 1rem;" title="回到顶部">
      <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
  </a>

  <button id="toc-drawer-button" class="tw-block tw-bg-bgColor-secondary tw-rounded-full md:tw-hidden" style="padding: 0.6rem; line-height: 1.3rem; font-size: 1rem;">
      <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>
  </button></div>
<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/lightgallery/lightgallery.min.css">
        <noscript><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"></noscript><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript>
<script>window.config={"autocomplete.min.js":"/lib/autocomplete/autocomplete.min.js","comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"pagefind.js":"/pagefind/pagefind.js","search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","pageLength":null,"snippetLength":50,"termFrequency":null,"termSaturation":null,"termSimilarity":null,"type":"pagefind"}};</script><script
    src="/lib/lightgallery/lightgallery.min.js"
    
      defer
    
  ></script><script
    src="/lib/lightgallery/lg-thumbnail.min.js"
    
      defer
    
  ></script><script
    src="/lib/lightgallery/lg-zoom.min.js"
    
      defer
    
  ></script><script
    src="/lib/katex/katex.min.js"
    
      defer
    
  ></script><script
    src="/lib/katex/auto-render.min.js"
    
      defer
    
  ></script><script
    src="/lib/katex/copy-tex.min.js"
    
      defer
    
  ></script><script
    src="/lib/katex/mhchem.min.js"
    
      defer
    
  ></script><script
    src="/js/katex.min.js"
    
      defer
    
  ></script><script
    src="/js/theme.min.js"
    
      defer
    
  ></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script><script type="text/javascript" src="/js/custom.js"></script>

<script type="speculationrules">
  {
    "prerender": [
      {
        "where": { "href_matches": "/*" },
        "eagerness": "moderate"
      }
    ]
  }
</script>
</body>

</html>
